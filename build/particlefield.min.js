var ParticleField=function(e){function d(e){if(!e)throw"You need to specify a canvas element";r=e,n.num_particles=n.rows*n.cols,i=r.getContext("2d"),s=r.width=n.cols*n.spacing+n.margin*2,o=r.height=n.rows*n.spacing+n.margin*2;for(var u=0;u<n.num_particles;u++){var c=Object.create(t);c.x=c.orig_x=n.margin+n.spacing*(u%n.cols),c.y=c.orig_y=n.margin+n.spacing*Math.floor(u/n.cols),a[u]=c}n.mouse&&r.addEventListener("mousemove",function(e){h=!0;var t=r.getBoundingClientRect();f=e.clientX-t.left,l=e.clientY-t.top}),v()}function v(){if(c){if(!h){var e=m();f=e.mx,l=e.my}for(var t=0;t<n.num_particles;t++){var r=a[t],u=f-r.x,d=l-r.y,g=u*u+d*d;if(g<n.radius){var y=Math.atan2(d,u),b=-n.radius/g;r.vx+=b*Math.cos(y),r.vy+=b*Math.sin(y)}r.x+=(r.vx*=.95)+(r.orig_x-r.x)*.25,r.y+=(r.vy*=.95)+(r.orig_y-r.y)*.25}c=!c}else{var w=i.createImageData(s,o);for(var E=0;E<n.num_particles;E++){var r=a[E],S=(Math.floor(r.x)+Math.floor(r.y)*s)*4;w.data[S]=n.color[0],w.data[S+1]=n.color[1],w.data[S+2]=n.color[2],w.data[S+3]=n.color[3]}i.putImageData(w,0,0),c=!c}p&&requestAnimationFrame(v)}function m(){if(u)return u(f,l,s,o,n);var e=Date.now()*.0015;return f=s*.5+.4*s*Math.cos(e),l=o*.5+.6*o*Math.cos(e)*Math.sin(e),{mx:f,my:l}}function g(){return n}function y(e){console.log("here");for(var t in e)n[t]=e[t]}function b(){return n.mouse}function w(e){return n.mouse=e,n.mouse}function E(){p=!0,v()}function S(){p=!1}function x(e){u=e}var t={vx:0,vy:0,x:0,y:0},n={rows:100,cols:240,num_particles:null,spacing:4,margin:40,radius:Math.pow(50,2),mouse:!0,color:[0,0,0,255]},r,i,s,o,u,a=[],f=0,l=0,c=!1,h=!1,p=!1;return y(e),{draw:d,start:E,stop:S,getMouseState:b,setMouseState:w,getOptions:g,setOptions:y,setCustomAnimation:x}};(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();